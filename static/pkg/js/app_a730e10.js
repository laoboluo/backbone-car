;/*!static/modules/model/img.js*/
define("static/modules/model/img",function(i,t,e){var d=($(window).width()-18)/2,n=Backbone.Model.extend({initialize:function(i){h=d/i.width*i.height,this.attributes.viewWidth=d,this.attributes.viewHeight=h}});e.exports=n});
;/*!static/modules/collection/img.js*/
define("static/modules/collection/img",function(t,a,e){var o=t("static/modules/model/img"),i=Backbone.Collection.extend({model:o,imageId:0,fetchData:function(){var t=this;$.get("data/imageList.json",function(a){if(a&&0===a.errno){a.data.sort(function(){return Math.random()>.5?1:-1});for(var e=0;e<a.data.length;e++)a.data[e].id=++t.imageId;t.add(a.data)}})}});e.exports=i});
;/*!static/modules/layer/layer.js*/
define("static/modules/layer/layer",function(i,e,t){var a=$(window).height(),n=$(window).width(),l=Backbone.View.extend({imageId:0,nowidx:1,imageList:[],events:{"tap .layer-container img":"toggleTitle","swipeLeft .layer-container img":"showNextImage","swipeRight .layer-container img":"showPreImage","tap .layer .go-back":"goBack"},tpl:_.template($("#tpl_layer").html()),render:function(i){var e=this.collection.get(i);if(!e)return void(location.href="");this.imageId=e.get("id"),this.imageList.push(this.imageId);var t={url:e.get("url"),title:e.get("title"),style:"line-height: "+a+"px;"},l=this.tpl,s=l(t);this.$el.find(".layer").html(s),this.$el.find(".layer-container img").attr("width",n)},goBack:function(){if(this.imageList.pop(),this.imageList.length){var i=this.imageList[this.imageList.length-1],e=this.collection.get(i);this.updateView(e)}else this.$el.find(".layer").hide()},toggleTitle:function(){this.$el.find(".layer .header").toggleClass("hide")},showNextImage:function(){this.imageId++;var i=this.collection.get(this.imageId);if(i?this.imageList.push(this.imageId):(alert("已经是最后一张了！"),this.imageId--),event.preventDefault(),!this.$el.find(".layer-container ul li img").is("animated")){this.$el.find(".layer-container ul li").eq(this.nowidx).animate({transform:"translateX(-100%)"},500),this.nowidx++,this.nowidx>2&&(this.nowidx=0),this.$el.find(".layer-container ul li img").eq(this.nowidx).attr("src",i.get("url"));var e=i.get("url");console.log(e),this.$el.find(".layer-container ul li ").eq(this.nowidx).css("transform","translateX(100%)").animate({transform:"none"},500),this.$el.find(".layer .header h1").html(i.get("title"))}},showPreImage:function(){this.imageId--;var i=this.collection.get(this.imageId);if(i){if(this.imageList.push(this.imageId),this.$el.find(".layer-container ul li").eq(this.nowidx).animate({transform:"translateX(100%)"},500),this.nowidx++,this.nowidx>2&&(this.nowidx=0),this.$el.find(".layer-container ul li img").is("animated"))return;this.$el.find(".layer-container ul li img").eq(this.nowidx).attr("src",i.get("url"));var e=i.get("url");console.log(e),this.$el.find(".layer-container ul li ").eq(this.nowidx).css("transform","translateX(-100%)").animate({transform:"none"},500),this.$el.find(".layer .header h1").html(i.get("title"))}else alert("已经是第一张了！"),this.imageId++},updateView:function(i){this.$el.find(".layer-container img").attr("src",i.get("url")),this.$el.find(".layer .header h1").html(i.get("title"))}});t.exports=l});
;/*!static/modules/list/list.js*/
define("static/modules/list/list",function(t,e,i){var n=Backbone.View.extend({events:{"tap .search span":"showSearchView","tap .type li":"showTypeView","tap .go-top":"goTop"},tpl:_.template('<a href="#layer/<%=id%>"><img style="<%=style%>" src="<%=url%>" alt="" /></a>'),leftHeight:0,rightHeight:0,initialize:function(){var t=this;this.initDOM(),this.listenTo(this.collection,"add",function(t){this.render(t)}),$(window).on("scroll",function(){$("body").height()<$(window).scrollTop()+$(window).height()+200&&t.getData(),t.showHideGoTop()}),this.getData(),this.touchmovepic()},goTop:function(){window.scrollTo(0,0)},showHideGoTop:function(){$(window).scrollTop()>300?this.$el.find(".go-top").show():this.$el.find(".go-top").hide()},getData:function(){this.collection.fetchData()},initDOM:function(){this.leftContainer=this.$el.find(".left-container"),this.rightContainer=this.$el.find(".right-container")},render:function(t){var e=t.get("viewHeight"),i={id:t.get("id"),url:t.get("url"),style:"width: "+t.get("viewWidth")+";height: "+e+";"},n=this.tpl,o=n(i);this.leftHeight>this.rightHeight?this.renderRight(o,e):this.renderLeft(o,e)},renderRight:function(t,e){this.rightContainer.append(t),this.rightHeight+=e+6},renderLeft:function(t,e){this.leftContainer.append(t),this.leftHeight+=e+6},getSearchValue:function(){return this.$el.find(".search input").val()},checkInputValue:function(t){return/^\s*$/.test(t)?(alert("请输入搜索内容！"),!1):!0},searchCollectionByKey:function(t,e){return this.collection.filter(function(i){return"type"===e?i.get("type")==t:i.get("title").indexOf(t)>-1})},clearView:function(){this.leftContainer.html(""),this.rightContainer.html(""),this.leftHeight=0,this.rightHeight=0},resetView:function(t){for(var e=0;e<t.length;e++)this.render(t[e])},showSearchView:function(){var t=this.getSearchValue();if(this.checkInputValue(t)){t=t.replace(/^\s+|\s+$/g,"");var e=this.searchCollectionByKey(t);this.clearView(),this.resetView(e)}},getDOMId:function(t){return $(t).attr("data-id")},showTypeView:function(t){var e=this.getDOMId(t.target);console.log(t.target,111);var i=this.searchCollectionByKey(e,"type");this.clearView(),this.resetView(i),this.$el.find(t.target).attr("class","cur").siblings().removeClass("cur")},touchmovepic:function(){var t,e,i=document.getElementById("list"),n=document.getElementById("type"),o=0,s=0,r=0,h=document.documentElement.clientWidth;i.addEventListener("touchstart",function(e){e.preventDefault();var i=e.touches[0];t=i.clientX},!0),i.addEventListener("touchmove",function(i){var h=i.touches[0];n.style.transition="none",s=h.clientX-o,o=h.clientX;var l=h.clientX-t;e=r+l,n.style.transform="translateX("+e+"px)"},!0),i.addEventListener("touchend",function(t){t.touches[0];r=e;var i=r+2*s;i>0?(n.style.transition="all 0.6s cubic-bezier(.34,1.81,.51,1.68) 0s",i=0):-760+h>i?(console.log(i,1111),n.style.transition="all 0.6s cubic-bezier(.34,1.81,.51,1.68) 0s",i=-1390+h):n.style.transition="all 0.6s cubic-bezier(0.2, 1.05, 0.58, 1.01) 0s",n.style.transform="translateX("+i+"px)",r=i},!0)}});i.exports=n});
;/*!static/modules/app.js*/
define("static/modules/app",function(e,n,t){{var o=e("static/modules/collection/img"),r=e("static/modules/layer/layer"),l=e("static/modules/list/list"),i=new o,a=new r({el:$("#app"),collection:i}),s=(new l({el:$("#app"),collection:i}),Backbone.Router.extend({routes:{"layer/:id":"renderLayer","*other":"renderList"},renderLayer:function(e){a.render(e),console.log(e),a.$el.find(".layer").show()},renderList:function(){a.$el.find(".layer").hide()}}));new s}t.exports=function(){Backbone.history.start()}});